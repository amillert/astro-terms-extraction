PBH formation from spherically symmetric hydrodynamical perturbations: a review
Primordial black holes, which could have been formed in the very early Universe due to the collapse of large curvature fluctuations, are nowadays one of the most attractive and fascinating research areas in cosmology for their possible theoretical and observational implications. This review article presents the current results and developments on the conditions for primordial black hole formation from the collapse of curvature fluctuations in spherical symmetry on a Friedman-Lemaître-Robertson-Walker background and its numerical simulation. We review the appropriate formalism for the conditions of primordial black hole formation, and we detail a numerical implementation. We then focus on different results regarding the threshold and the black hole mass using different sets of curvature fluctuations.
Finally, we present the current state of analytical estimations for the primordial black hole formation threshold, contrasted with numerical simulations. Primordial Black Holes; Early Universe Cosmology; Numerical General Relativity
One of the great mysteries in Science is the composition of dark matter, which accounts for the 27% of the present Universe. Although there are different theories and candidates that try to explain it, still the answer remains elusive. One of the most promising possibilities is Primordial Black Holes (PBHs), i.e. black holes (BH) generated at earlier than star formation times and therefore not of stellar origin. For the current observational status and constraints of PBHs in the form of dark matter we refer the reader to [1–6] .
PBHs were first considered in [7,8]. They could be formed in the very early Universe due to the gravitational collapse of cosmological perturbations. Under this scenario, PBHs could have been generated as a consequence of high non-linear peaks in the primordial distribution of density perturbations, leaving open the possibility that PBHs could constitute a significant fraction of the Dark Matter (DM) [9–31].  PBHs with a size smaller than MPBH < 10−20 M would have been already evaporated due to Hawking radiation [32]. Therefore, those with higher masses can account for dark matter. In addition, they may be responsible to seed supermassive black holes at the centre of galaxies [33,34], to generate large-scale structure through Poisson statistics [35] or change the thermal history of the Universe [36].  Although PBHs were theorized time ago, it has not been until now that their popularity has increased exponentially. The current big interest in PBHs (and its golden age) is due to the first detection of gravitational waves from a black hole merger by the LIGO/Virgo collaborations [37]. Soon after this remarkable discovery, it was suggested that the constituents of the black hole merger could have had a primordial origin [16,38]. Later on, several analyses on the data signals have suggested that the population of black holes detected could have a primordial origin [24,39–43] (see also references therein). On the other hand, recent results on the NANOGrav experiment [44] have also been connected with PBHs [23,45–52] If formed by the collapse of inflationary perturbations, the abundance of PBHs is exponentially sensitive to the threshold of the gravitational collapse δc [53] (where δc is the minimum amplitude of the gravitational potential peak related to the perturbation undergoing to gravitational collapse and leading to a BH). In order to obtain the necessary precision on δc, a numerical analysis of PBH formation is an obvious way to go.
Numerical simulations of PBH formation started some time ago, the first one was done in [54], where was studied the non-linear behavior of the gravitational collapse. Later on, in [55,56], δc was computed and a scaling behaviour for the PBH mass was found whenever the amplitude of the perturbation was close to δc [55–58]. The value of the scaling exponent found was consistent with the one given in the literature and computed from a perturbative treatment[59,60], or from numerical simulations [61] in asymptotically flat spacetime. While the constant of proportionality appearing in the scaling law depends on the specific shape of the perturbation considered, the scaling exponent is a universal quantity only dependent on the type of fluid. Earlier simulations on PBHs were mainly based on the application of a Lagrangian hydrodynamic code based on finite differences and developed from an earlier work [62], solving Misner-Sharp equations [63], which describe the motion of a relativistic fluid in a curved spacetime.  An inconvenience of this procedure is the appearance of a coordinate singularity after forming the apparent horizon, which breaks down the simulation. To resolve that issue, Hernandez-Misner equations [64] (which are the Misner-Sharp equations in null coordinates) are used to evade the formation of an apparent horizon and follow the subsequent evolution to determine the value of the black hole mass. The method is based on [65]. As was shown in [66], the formation of PBHs from the collapse of initial fluctuations at super-horizon scales does not form shocks (a discontinuous solution) in comparison with the earlier result of [57], where shock waves were found, but using initial conditions on sub-horizon scales.
On the other hand, even if a numerical code allows to compute the threshold, the realization of a numerical simulation can be quite expensive to be actually useful for statistical applications such as the calculations of PBH abundances. Therefore an analytical expression would drastically simplify the problem. There are some analytical estimations of δc (e.g. [67] and [68]), which were based on analytical models under certain assumptions. However, numerical simulations have shown that, even for a fixed equation of state, δc is not universal [56,57,66,69–73]. The main argument is that δc is dependent on the specific detail of the initial curvature fluctuation [72], i.e., on the scale dependence or “shape” of the perturbation, something that these analytical estimations do not take into account.
Some works have tried to characterize the threshold for black hole formation in terms of the initial density perturbation profile. In [74] was used the amplitude of the curvature fluctuation and its second radial derivate at the centre to characterize the initial configuration profiles, showing that the probability of PBH formation is sensitive to them. Later on, in [75], numerical simulations were used to argue that the formation of a PBH from an over-density peak in a FLRW Universe assuming the perturbation to be initially at super cosmological scales, it only depends upon two master parameters: the integral of the initial curvature perturbation, and the edge of the over-density distribution. The paper in [72] recently refined the arguments of [75] by showing that these parameters may be more conveniently given in terms of the amplitude of the ”gravitational potential” at its maximum (r = rm), as already noticed in [70], and that it mainly depends upon the functional form (shape) of the gravitational potential. More precisely, in [72], the threshold δc was identified with the peak of the “compaction function” [70] at super-horizon scales. The compaction function, closely resembles the Schwarzschild gravitational potential and is defined as twice the local excess-mass over the co-moving areal radius.  Following the aim to have a more accurate analytical estimation for the threshold of PBH formation, recently in [76] was argued that the threshold for primordial black hole formation should be quite insensitive to the physics beyond rm: The threshold is the amplitude for which a "black hole" with zero mass would be formed. Therefore, all the over-density beyond rm will be diffused away while that just in the proximity of rm will block the collapse.
With those arguments, it was shown that during a radiation-dominated epoch (equation of state p = wρ with w = 1/3), with a very good approximation, there exists a universal threshold value for the volume-averaged compaction function, which is actually shape-independent. Taking into account that the volume average is dominated by scales near the maximum of the compaction function, in [76] it was shown that it is enough to parametrize the profile dependence of δc by the curvature-shape around the compaction function at its maximum. Applying this result was made an analytical approximation for δc taking into account the shape dependence on the curvature fluctuation, which matches that found in simulations to within a few percent [76].
From the results in [76], there was the question of whether or not this universality on the averaged critical compaction function is generic and not only an accident of radiation. Thus in [77], was addressed the universality question beyond the case of a radiation fluid. In [77] was generalized the arguments of [76] to provide a new analytical estimation for the threshold in terms of the equation of state and the shape-profile. This analytical formula was tested in front of numerical simulations and was found an accuracy better than a 6%.  The other half-part of the problem is the determination of the final PBH mass. When a perturbation collapses, it will firstly form an apparent horizon with an associated mass MPBH,i. After that, due to the surrounding fluid of the FLRW background, there is an accretion process up to a final mass MPBH, f when the PBH is formed. As we have indicated, for fluctuations whose amplitude is near the threshold (the critical regime) was found a scaling law for the PBH mass in terms of the amplitude of the perturbation [55–58]. Although the importance of this result was pointed out in the context of critical collapse [78], nowadays it is substantially relevant because, as is indicated in the current literature [53], the PBHs with higher probability of formation are those that are formed in the critical regime. The probability distribution function is exponentially suppressed beyond the threshold, and therefore can be directly used the scaling law for estimations of PBH abundances.
On the other hand, some studies have also considered the maximum size of PBHs at the formation time and the accretion effect from the surrounding background in the final mass of the PBH MPBH, f.
It was already noticed in [67,79] that the accretion effect for small PBH should be small. Specifically, in[79] were derived some analytical expressions for the upper bound of a PBH formed by the collapse of hydrodynamical perturbations. In [80] was computed numerically the MPBH, f for different curvature profiles and was quantified the accretion effect, which could be substantially large for PBHs formed beyond the critical regime O(10%). There was also made a numerical comparison with some estimations of [79] for the case of radiation fluid.
In conclusion, considering the recent developments of the field and future perspectives, we present this review paper to give the current state-of-the-art regarding the analytical, numerical and theoretical results about PBH formation from the collapse of hydrodynamical perturbations on a FLRW background under spherical symmetry; currently, the most common and popular scenario in the literature [32]. We hope that this review paper allows the scientific community to be introduced to the topic of PBH formation and understand the main insights.
We want to tell the reader that there are fascinating and valuable review papers on the PBH topic with a different perspective than the one considered here. For an interesting historical review of the dark matter candidates, we refer the reader to [81]. About reviews that focus on gravitational waves applied to PBHs and the different constraints to account for the dark matter we have [1,82–88]. Another interesting review with potential applications to PBHs is [89], which is focused on scenarios with deviations from radiation domination in the early Universe.
This review paper is organized as follows: In section 2 we present the basics of PBH formation. In section 3 we give some basic details about the statistical estimation of PBH abundances. In section 4 we give the necessary ingredients to set up the formalism of PBH formation, in particular: the differential equations that describe the collapse of the perturbations, the initial conditions, the definition of compaction function and the threshold criteria. In section 5 we discuss and comment on the different numerical techniques employed in the literature, and we focus on a specific method publicly available. In section 6 we give numerical results regarding the threshold and PBH mass in terms of the specific profiles using numerical simulations. In section 7 we discuss in detail the different developments for the analytical estimation of the threshold. Finally, in section 8 we enumerate other scenarios of PBH formation not explicitly considered in this review.
As we have pointed out in the previous section 1, PBHs could have been formed in the very early Universe during radiation domination due to the gravitational collapse of large curvature perturbations generated during inflation [7,8].
Under this scenario, the collapse or dispersion of those hydrodynamic perturbations depends on the perturbation’s strength: if its greater than a given threshold, the perturbation will collapse and form a BH after the perturbation crosses the cosmological horizon. Otherwise, if it is lower, it will disperse because of pressure gradients preventing the collapse (a schematic picture can be found in Fig.1). Both things could happen, i.e., the perturbation could undergo gravitational collapse and subsequently bounce. In this case, the fluid is dispersed and collapsed continuously, making rarefactions waves (we will see it in more detail in section 6). This behaviour is particularly evident when the initial strength of the perturbation is very close to its threshold value. Therefore, pressure gradients play a crucial role in the collapse of the perturbation. If pressure gradients are strong enough, they will prevent gravitational collapse, which implies having a large threshold compared to the situation when the pressure gradients are small.  A big effort has been made during the past decades to find the correct PBH formation criteria. The first estimation of a threshold was given by [7], using a Jeans-length argument and Newtonian gravity.  The criteria for the formation of a BH used was that the size of an over-density at the maximum expansion should be larger than the Jeans length but also smaller than the particle horizon. This translates to the requirement that the peak value of the density contrast at scales smaller than the cosmological horizon must be at least w (where w is the equation of state of the perfect fluid which fills the FLRW Universe) in order to collapse.
A simple, intuitive picture of PBH formation and its threshold connected with the Jeans length argument can be found in [12], and we summarize it here. Consider a cosmological perturbation at super-horizon scales. The spacetime metric can be written as a closed FLRW Universe (we will see in more detail in section 4) with a radial dependence on K(r).
If we ignore the radial derivate of K(r), the time-time component of the Einstein equations is given by, which basically corresponds to the FLRW equation but with a small non-homogeneity term given by K(r).
The previous equation allows to define a density contrast as.
A region will collapse instead of expanding when K > 0 if we ignore the radial dependence on K(r).  This precisely happens when 3K/a 2 = 8πρ, which corresponds roughly when the Hubble scale becomes equal to the lengthscale of the curved region. In this case, the assumption done with Eq.1 is no anymore valid but still can be assumed to get some threshold estimation.  On that time (let’s called it t = tc), if we consider an homogeneous and isotropic Universe, this would imply.
The criteria is that perturbations can not collapse if they have smaller scales than the Jeans length, which immediately implies that k, where cs is the sound speed of the fluid (perfect fluid in our case), and k is the wavelength mode associated to the perturbation. Therefore, the condition that should satisfy the density contrast at the time when the perturbation reenters the horizon which is basically the threshold value estimation obtained in [7].
The second analytical estimation came years later in [68]. The authors considered a compensated "three zone" model, i.e, a central over-dense region followed by an under dense layer (which compensates the over density) and finally the FLRW background, to estimate the threshold for BH formation. Following an argument about the sound waves at the maximum expansion of the perturbation, it was found that the threshold of the peak value of the overdensity when it renters the horizon must be.
Later on, however, became clear that the threshold depends on the shape of the curvature perturbation [56,58,75]. Moreover, it also depends on the specific equation of state of the fluid, since pressure gradients plays a role on the determination of it: larger is w stronger are the pressure gradients and therefore higher is the threshold.
In [70] a new criteria for PBH formation was introduced. Importantly, it was found that the peak of the compaction function (the average mass excess on a given volume) was a good criterion for PBH formation and currently have become the standard definition of threshold, that we call δc. Previously to this criteria, some other measures for the threshold "definition" were not empty of some issues. See [72] for a historical perspective about that.
In [72] simulations were performed for a radiation fluid with a set of curvatures profiles leading to a range of threshold values given by 0.41 . δc ≤ 2/3 using the criteria of the compaction function’s peak as the threshold definition. Later on, in [76] the minimum threshold value was refined, getting 0.4 rather than 0.41 in the case of a radiation fluid. This difference was due to a choice of unphysical profiles in some extreme limit of the range parameter.
Although δc is a profile dependent quantity, in [76,77] was shown that exist an (approximately) universal value given by the averaged critical compaction function, which allowed to build a sufficiently accurate analytical expression for δc, which only depends on the type of fluid and the curvature around the peak of the compaction function.  On the other hand, if a perturbation is sufficiently strong, it will collapse and form an apparent horizon.  Later on, will follow a process of accretion of energy density from the surrounded FLRW background until FRW background Gravitational collapse Pressure gradients
Figure 1. Schematic picture of the collapse/dispersion of a perturbation on a FLRW background.  reaching a stationary state, when the final mass of the PBH is achieved. As was shown in [55,56], the final PBH mass follows a critical scaling law when the amplitude of the perturbation is close to its threshold value (the critical regime), with values of γ consistent with previous numerical computation [78,90] γ ≈ 0.356. The scaling exponent is universal and only depends on the type of fluid, not on the initial condition. The MH is the mass of the cosmological horizon at the time of horizon crossing (when the lengthscale of the perturbations equals the cosmological horizon). The constant K depends on each initial condition used. As in the case of the threshold, the values of K are different depending on what initial conditions, but with values O(1) [91].
The simulations in [56] were done for δ − δc & 10−5 which was not sufficient to test the critical regime up to very small values, i.e, up to machine precision δ − δc ≈ 10−15. In [66] it was verified, finally, the scaling law up to machine precision, and this was tested with an explicit example of a gaussian perturbation.
The abundance of PBHs
This section will give a brief review of the two approaches commonly used in the literature to perform PBH statistics (formed in radiation-dominated Universe) and estimate their abundances. In this review, we do not focus on the statistical estimation of PBH abundances, for which there are extensive works in this direction, with different approaches and methods. If the reader is interested, we suggest to check these references and the ones therein [92–112]. But to show this topic at the basic level, we will basically describe the Press-Schechter [113] and the peak theory [114] procedures. This section aims to clearly point out the relation between the threshold and PBH mass on the estimation of PBH abundances, especially why the threshold should be known with enough accuracy to be useful for statistics.  In both cases, we consider the amplitude of the peak of density contrast in the comoving slicing, (usually denoted in the literature as ∆ ≡ δρ(0)/ρb [53,115]), as a statistically distributed variable. The power spectrum associated to the density contrast is defined as, where δD is the Dirac delta and the moments j of P∆ are given by.
In the Press-Schechter formalism we make two assumptions: i) the density contrast field ∆ is a Gaussian variable ii) perturbations with ∆ > ∆c will collapse and form a PBH. So basically we integrate the probability distribution P(∆) over the range ∆c ≤ ∆ < ∆max, where ∆max is the maximum allowed value. In practice, we integrate up to ∆max → ∞ since the probability distribution is a rapidly decreasing function above ∆c, and therefore does not change the result and allows to simplify the computation. It’s important to notice that ∆c 6= δc, since we are comparing the critical density contrast with the critical averaged density contrast.  Finally, consider a Gaussian distribution probability distribution, the abundance of PBHs can be computed as, where ΓU(a, b, c) is the confluent hypergeometric function1.
Where has been assumed that the scaling law is accurate always even when ∆  ∆c (something not true, as we will show in section 6), but since the probability distribution is exponentially smaller for large ∆, Eq.10 is accurate. In the case of considering a monochromatic mass spectrum, i.e., that all the PBHs formed to have the same mass (in particular to the horizon mass MH), the abundance is given by.
This can be obtained by simply taking the limit γ → 0 and K = K¯ in Eq.10.  The procedure in the peak theory approach is a bit different. It makes statistics on counting the numbers of over-threshold peaks on the over-density, another approach used the curvature fluctuation ζ peaks instead [99,116].
We summarize the procedure done in [53] to estimate the abundances through peak theory. First of all, we define the variable ν = ∆/σ0, which in the rare peak assumption we have that ν  1.
The number of rare peaks is given by [114].  The confluent hypergeometric function is defined as where a is the scale factor and tf
is the time when the PBH are formed. It’s clear that we are considering only that peaks higher than the threshold value νc will contribute to the formation of PBHs. Therefore, the abundance of PBHs measured at formation with respect to the background energy-density can be computed as.
The scaling law mass, in terms of ν is given by, where σ˜0 = σ0a 2H2 and tm is the time of horizon crossing (when the length-scale of the perturbation equals the Hubble horizon). Taking into account that numerical simulations has shown that a f ≈ am ≈ 3, and using the saddle point approximation [117] νs ≈ νc + γ/νc, finally we get. From Eqs.15,10,11 we clearly see the exponential dependence on the threshold for PBH formation and the linear dependence on the constant K associated to the scaling law. This is the reason why an accurate determination of the threshold is essential, since the abundances depends exponentially on it. These two methods are however only an approximation of the true statistics which consider the fact that each statistical realization of profiles have different threshold. This was developed in [92], we will not discuss it here as it is beyond the scope of this review paper. However, as it can be seen in [92] one finds again the generic behavior that β is exponentially sensitive to the threshold.
Cosmological set up for PBH formation
This section reviews the needed ingredients to simulate the formation of PBHs on a FLRW Universe under spherical symmetry and filled by a perfect fluid. We will see what differential equations describe the gravitational collapse, the consistent initial conditions for PBH formation we need to use, and the boundaries condition to supply. Later on, we will study the formation of the apparent horizon and characterize it in terms of the expansion of the congruences. Finally, we will describe the process of accretion of the PBH mass from the FLRW background and how it can be estimated its final mass.
Misner-Sharp equations
The Misner-Sharp equations [63] describe the motion of a relativistic fluid with spherical symmetric. It corresponds to the Einstein field Equations written in the comoving gauge (the gauge we use in this review paper). To obtain them, first of all, we need to consider a perfect fluid with energy-momentum tensor, where R(r, t) is the areal radius, A(r, t) is the lapse function and dΩ2 = dθ is the line element of a 2-sphere. The components of the four velocity u µ are given by u t = 1/A and u i = 0 for i = r, θ, φ, since we are considering comoving coordinates (comoving gauge). In all the review paper, we will use units GN = c = 1.
Solving the Einstein field equations for this problem, appear the following quantities, where Dt and Dr are the proper time and distances derivatives, respectively. U is the radial component of the four-velocity associated with an Eulerian frame (so not comoving), which measures the radial velocity of the fluid with respect to the origin of coordinates. The Misner-Sharp mass M(r, t) is introduced as, which is related with Γ, U and R though the constraint, where Γ is called the generalized Lorentz factor. Finally, the differential equations governing the evolution of a spherically symmetric collapse of a perfect fluid in general relativity are.
We refer to the reader to check [63] to see the details of the derivation. The boundary conditions in the Misner-Sharp equation are R(r = 0, t) = 0, leading to U(r = 0, t) = 0 and M(r = 0, t) = 0. Then, by spherical symmetry, we have Dr p(r = 0, t) = 0 and also we consider a perfect fluid p = wρ.  At r → ∞, we should recover the solution of the FLRW background. However, in a numerical simulation, we have to handle the discretization of time and space. Therefore, is used the condition Dr p(r = rf , t) = 0 (where rf if the outer point of the grid) to match with the FLRW solution and avoid reflections from density waves. On the other hand, Eq.25 is called the Hamiltonian constraint, which is commonly used to check the correct solution of the numerical equations. For the case p = wρ, the lapse equation in Eq.26 can be solved considering A(rf , t) = 1 to match with the FLRW spacetime is the energy density of the FLRW background and ρ0 = 3H2
Actually, the Misner-Sharp equations can be written in a more advantageous way to perform numerical simulations using the definitions. The dot U˙ represents the time derivate ∂U/∂t and the ρ the radial derivative ∂ρ/∂r.
The gradient expansion approximation, initial conditions and compaction function
The gradient expansion method [118] (also called long-wavelength approximation) was used in [119] to set up consistent initial conditions for PBH formation on a FLRW background at super-horizon scales.  First of all, let’s consider a cosmological perturbation at super-horizon scales, i.e. with a length-scale Rm much larger than the Hubble horizon. We can define a parameter e to relate the two scales: the Hubble horizon RH and the length-scale of the perturbation Rm, where RH = 1/H. It is clear that at super-horizon scales we will have e  1. The gradient expansion method allows to expand these inhomogeneities in the spatial gradient in terms of e. In the limit e → 0, the spacetime locally corresponds to the FLRW metric, when the perturbation is smoothed out at sufficiently large scales Rm.
Consider a general spacetime metric in the 3 + 1 Arnowitt-Deser-Misner (ADM) formalism [120,121], in general, the spatial part of the metric can be decomposed in, where γij, βi and α are the spatial metric, shift-vector and lapse function respectively. The ζ is usually called the curvature fluctuation. Under the gradient expansion method, was shown in [70,122–124] that. Therefore in spherical symmetry and in the limit e → 0, the metric of Eq.34 can be written as.
Notice the time independence of ζ(r˜) since at super-horizon scales it is shown that ˙ζ = O(e 2). Is important to point out, that although we consider the comoving gauge, other gauges are possible. In particular, in [70] was used the constant mean curvature gauge instead. But as was shown in [69,123], the differences between the two gauges in the ζ are of O(e 2).
Finally, the metric Eq.36 can be also written in other coordinates as a FLRW metric with a non-constant curvature K(r).
The change of coordinates r,r˜ between the two metrics and the conversion between K(r), ζ(r˜) are given by the following relations, which have been obtained in several works previously (not necessarily in the context of PBH formation all of them) [72,74,108,125]:
Therefore, the cosmological perturbation will be characterized by the curvature perturbation K(r), ζ(r˜).  The Misner-Sharp equations can be solved at leading order in e  1 using the wavelength approximation as was done in [119], where for e → 0 we recover the (FLRW) solution. The perturbations of the tilde variables at first order in gradient expansion were computed in [119], which we summarize here:
The perturbations in the r˜ coordinate with ζ(r˜) are [72]; The area radius of the length-scale Rm is given by Rm(t) = a(t)rm or also Rm(t) = a(t)r˜me ζ(r˜m) with the r˜ coordinate taking into account Eq.38. As was shown in [126], where was applied the gradient expansion method beyond first order using an iterative scheme (see [126] for more terms in the e expansion in comparison with Eq.39), the long-wavelength approximation at first order is accurate enough if a sufficiently small e parameter is taken.
When we take e = 0 we recover the background solution equations: H(t) = H0t0/t , a(t) = a0(t/t0) α and RH(t) = RH(t0)(t/t0) where a0 = a(t0) , H0 = H(t0) = α/t0 and RH(t0) = 1/H0. Moreover we define α = 2/3(1 + w). We also consider as initial condition that rm = ΛRH(t0), where Λ is some number (the same with r˜m). Is commonly defined in the literature a time scale given when e(tm) = 1, which precisely correspond to the time when the Hubble horizon equals the lengthscale of the perturbation (the time of horizon crossing) tm = t0(a0rm/RH(t0))1/(1−α).
On the other hand, the amplitude of a cosmological perturbation can be measured as the averaged density contrast within a spherical region.
Related to that, in [70] was defined the compaction function C(r), which gives a measure of the mass excess on a given volume. In particular, where Mb (r, t) is the mass of the FLRW background in the volume V. The compaction function can also be written in terms of ¯δ as was shown in [69].
At leading order in e. From the above definitions, we finally define the compaction function at super-horizon scales at leading order of gradient expansion which yields.
The compaction function at super-horizon scales is an essential magnitude, since allows to use it to define the threshold itself. In particular, we now
define the location of the maximum of C(r) as rm, and its value Cmax = C(rm) is going to be used as a criteria for PBH formation as was proposed in [70], and rm (r˜m in the case of using the r˜ coordinate) is considered the lenghtscale of the perturbation. The threshold for PBH formation will correspond to the peak value of the critical compaction function, i.e, Cc(rm) = δc. Therefore, we define the "amplitude" of the perturbation as δm = C(rm). Perturbations with δm > δc will collapse and form a PBH. In the opposite case, perturbations with δm < δc, will disperse on the FLRW background with no black hole formation.  Notice that from Eq.37 we have a bound on the amplitude value δm at super-horizon scales given by.
Because of the previous definitions, the value of rm is given by the solution of C.  The definition of the compaction function at super-horizon scales using the ζ(r˜) perturbation instead of K(r) leads to a different sightly definition, which yields the following condition for the peak r˜m, and therefore. Interestingly, in [72] it was found at super-horizon scales, which relate the averaged mass excess with the local density contrast at rm.
In this review paper, we are going to focus on PBH type I, which are those that fulfill that the areal radius R is a monotonic function, i.e, R 0 > 0. Instead PBHs type II satisfy R 0 < 0 [127]. PBHs type II are still unexplored in the literature from a numerical point of view or even with a general analytical treatment.
Horizon formation
If an initial perturbation at super-horizon scales has an amplitude δm bigger than its threshold δc, the
perturbation will continue growing and, at some point, will be formed a trapped surface. It indicates the
onset of gravitational collapse.
To identify when trapped surfaces are formed, we have to consider the expansion Θ± of null geodesics
congruences k, orthogonal to a spherical surface Σ. The expansion is defined as, where is the spacetime metric induced on Σ. There are two congruences, we call them inwards.
In the case of flat spacetime, Θ− < 0 and Θ+ > 0, and these surfaces Σ are called normal surfaces.  On the other hand, if Θ± < 0 the surface is called trapped, while if both are positive Θ± > 0 the surface is anti-trapped. In our case, we have that. In spherical symmetry, we can consider that any point (r, t) is a closed surface Σ with a proper radius R. These points can be classified as normal, trapped and anti-trapped. Specifically, the transition from a normal to a trapped surface should satisfy Θ− < 0 and Θ+ = 0, which corresponds to a marginally trapped surface, usually called the "apparent horizon". Taking into account that, the condition for the apparent horizon is given by.
In Figure.2 can be seen the evolution of 2M(r, t)/R(r, t) and the congruences Θ± in time for a supercritical (with an amplitude δm > δc) Gaussian curvature fluctuation, after the first horizon has been formed. The same qualitative behaviour can be applied for any perturbation of PBH type I (with w 6= 0).  Figure 2. Top panel: Profile of 2M/R once the trapped surface has been formed. The dashed line corresponds to 2M/R = 1. Bottom panel: Profiles of the two expansions Θ± at the same time t than the top panel. The vertical orange lines corresponds to points where Θ± = 0. The initial fluctuation considered corresponds to a Gaussian profile.
Looking the Fig.2 we can see three points where 2M = R, and therefore three different surfaces that we can characterize: • Surface (A-B) In this region we have a transition between Θ+ > 0 and Θ− < 0 (normal region) to Θ+ < 0 and Θ− < 0. This horizon, moves inwards the computational domain, which eventually will encounter a singularity at r = 0.  • Surface (B-C) In this region we have a transition between Θ+ < 0 and Θ− < 0 to Θ+ > 0 and Θ− < 0 (normal region). This horizon, typically called "the apparent horizon", moves outwards the computational domain. Actually, this horizon and the previous one emerge from a single marginally trapped surface. During the evolution can be followed the motion of the horizon to obtain the PBH mass M(r∗, t), where r∗(t) is the location of the outer horizon in time. At the final stage of the gravitational collapse for very late times, this horizon will become static, i.e, r∗ = const.  • Surface (C-D) In the last region we have transition between Θ+ > 0 and Θ− < 0 (normal region) to Θ+ > 0 and Θ− > 0. This case corresponds to an anti-trapped surface, which corresponds to the cosmological horizon, moving outwards. We should mention that this horizon does not correspond to the cosmological horizon RH from the FLRW background, since the perturbed medium (deviated from the FLRW solution) affects the evolution of the cosmological horizon.  For a more formal discussion about horizons, we suggest the reader to check [128–137].
PBH mass and accretion
Once the apparent horizon is formed, the initial PBH mass, i.e., the mass of the PBH MPBH,i at the moment of formation of the first apparent horizon tAH, will start to grow up to arrive at a stationary value MPBH,f. This situation is different from the case of dust collapse w = 0, where the mass would increase forever since no pressure gradients would avoid the accretion of energy matter.  The process of accretion of energy-matter from the FLRW background has been studied in the past [7,79,138,139] in different scenarios. To estimate the final mass of the PBH, one could follow the motion of the apparent horizon until very late times when the horizon remains static. But since it could be computationally very expensive, we can use the Zeldovich-Novikov formula Eq.53 [139], which consider Bondi accretion [139–141], and in our case, assume that the energy density right outside the apparent horizon decreases as in an FLRW Universe. It is essential to indicate that this is not valid at the time tAH, since it neglects the cosmological expansion of the spacetime [142], but we can apply from sufficiently late time for t  tAH considering an effective constant accretion efficiency rate F [140,141]. This approximation was already used numerically in the context of PBH formation from domain walls in [143] with great success.
In particular, for very late times t  tAH the mass accretion follows, where F is commonly numerically found to be of order O(1). Taking into account the condition of apparent horizon in spherical symmetry RPBH = 2MPBH, the previous equation is solved analytically as: where Ma is the initial mass when the asymptotic approximation is used at the time ta. The value of F has been found to weakly depend on the specific shape of the perturbation and its amplitude but strongly on the equation of state w. Specifically, F depends on the high non-linear process of accretion and the counterpart of pressure gradients. F can be obtained numerically by fitting the evolution of MPBH(t) (at sufficiently late times after the formation of the apparent horizon, when it is valid). Using that, the PBH mass is estimated as the asymptotic mass value.
The final PBH mass will be dependent on the specific profile of the fluctuation, its initial amplitude δm and w. As was already shown in the past, in the critical regime where δm is very close to the critical value δc, then the black hole mass follows a scaling law [56–58], where γ ≈ 0.356 in radiation w = 1/3. The values of γ in terms of the equation of state w were found semi-analytically in [60] and are plotted in Fig.3. These results were numerically confirmed in [91].  Figure 3. Values of γ(w) plotted from the data of Table.1 in [60].  In Eq.56 the constant K depends on the specific shape of the profile considered and MH ≡ 1/2H(tm) is the Hubble mass, which is calculated at the time tm. Specifically, MH in terms of the initial values of perturbation can be written as: which will depend on the initial lenghtscale rm and the equation of state w (we can consider gauge values a0 = 1 and t0 = 1). In the case of using the r˜ coordinate is just needed to replace in Eq.57. The scaling law starts to deviate at x (for w = 1/3) as was indicated in [91]. It was shown explicitly in [73] that for large δm beyond the critical case, the scaling law seems to be deviated by order of O(10%) (at least for w = 1/3), but it can be smaller or larger depending on the profile considered. The deviation from the critical regime is expected to be also found for other w’s, but the quantification still is missing in the literature. As pointed out in [144], it is important to consider the scaling law behavior Eq.56 for the predictions of the PBH mass spectra.
Numerical techniques
Most of the times, PDEs can not be solved analytically, and numerical methods are needed. This is especially common in general relativity and is the case we have here. Nowadays several methods and tools can be employed in numerical relativity [145–153]. In the case of PBH formation, there is the extra difficulty that the gravitational collapse happens on a FLRW background, so not on asymptotically flat spacetime.
Different authors have employed different numerical procedures to simulate PBH formation from the collapse of curvature fluctuations under spherical symmetry, as we have mentioned in section 1. From a historical perspective, several works have used a finite differences approach to solve Hernandez-Misner-Sharp equations in the comoving gauge [55,56,58,71,72,75,91,119,154]. Alternatively, were also done simulations at earlier times using a different gauge, in particular, the mean curvature gauge [70]. The numerical results of both procedures with different gauges were verified to be consistent between them in [69]. A new numerical method came up recently using Pseudospectral methods [73] to solve Misner-Sharp equations together with the use of an excision technique to get the final mass of the black hole.
In this review, we are going to describe the pseudospectral collocation technique used in [73]. The basics of the numerical code are available here [155] (currently the only one in the literature publicly available), and therefore the reader can reproduce or even extent some of the results presented in this review.
Pseudospectral methods
Pseudospectral methods have been extensively used in computer science for solving complex physics phenomena [156–158]. The application to the field of numerical relativity has been also very popular to study different problems, from astrophysics to more oriented on high energy physics [159–174].  In what follows, we outline how to use the basics of the pseudo-spectral technique applied to our problem, which allows solving partially algebraically the differential equations describing the gravitational collapse. See also [175,176] for much more details and mathematical foundations. In particular, we use the Chebyshev collocation method (but there are also other formulations).  Let’s consider a function f(x) and fit it with Ncheb Chebyshev polynomials (any other orthonormal function could be used too). The function f(x) can be composed by a sum of Chebyshev polynomials are the Chebyshev polynomial of order k. The coefficients ck with k = 0, 1, ..., Ncheb are then obtained by solving. The points xk , which satisfies; are called Chebyshev collocation points.
To improve round-off errors in the numerical computations [176], is used the following identity of the diagonal components of the matrix D.
In spectral methods, the error decays exponentially with Ncheb. It represents a significant improvement in comparison with finite differences, where the error decays algebraically like 1/Nv , where v > 0 and N is the number of points of the grid. The exponential convergence in spectral methods is obtained thanks to the fact that the derivate at a given point is computed taking into account all the other points of the grid, instead of finite differences that only consider the neighbours.  The radial domain Ω in our case corresponds to Ω = [rmin,rmax] where rmax = NHRH(t0) and rmin = 0. NH is the number of initial cosmological horizons where we put the final point of the grid, which usually is enough to take NH ∼ 102 . The domain of the Chebyshev polynomials is [−1, 1], therefore we need to do a mapping between the physical domain and the spectral one. Different options are possible, but commonly is used a linear mapping.
x˜k are the new Chebyshev points rescaled to our physical domain Ω. Also, the Chebyshev matrix can be rescaled using the chain rule.
The imposition of boundary conditions in spectral methods is straightforward. In the case of Dirichlet boundary condition at xk , such that f(x = xk) = uD,bc, we just need to satisfy fNcheb (x = xk) = uD,bc.
In the case of Neumann boundary condition such that f we should satisfy that. The numerical stability will depend on the values chosen for dt and Ncheb. We don’t have a completely "freedom" to choose those values. If the number of points of the grid is increased, it will require a reduction on the time step dt, in order to avoid instabilities during the evolution. The Courant-Friedrichs-Lax (CFL) condition for hyperbolic PDEs already indicates that the maximum allowed time-step should fulfill dt ∝ 1/N2 .
There are situations where pressure gradients are substantially large during the numerical evolution.  This, for instance, can happen when the curvature fluctuation has very sharp profiles or when w becomes large. In this situation is needed to increase the numerical accuracy of the simulation. One possibility is to increase the number of points of the grid Ncheb, but of course, this would imply reducing the time step dt to ensure stability. The other one (which is actually better and more clever) is to use a composite Chebyshev grid: split the full domain into several Chebyshev grids depending on the density of points needed in specific regions of the domain. In particular, the full domain Ω is split in M subdomains as Ωl = [rl ,rl+1 ] with l = 0, 1..., M. A mapping between the spectral and physical domain for each is required. We choose a linear mapping again as, where x˜k,l are the new Chebyshev points re-scaled to the subdomain Ωl . The Chebyshev differentiation matrix is re-scaled again using the chain rule.
The numerical evolution is done independently in each subdomain, i.e., the spatial derivative is computed using the Chebyshev differentiation matrix D˜ l associated with each subdomain, and the time integration is done applying the Runge-Kutta 4 method on each subdomain.  To evolve across the different subdomains Ωl , is needed to impose boundary conditions. The approach followed is the one of [177], which is based on making an analysis of the characteristics of the field variables.  The prescription is that the incoming fields derivative is replaced by the time derivative of the outgoing fields from the neighbouring domain at the boundaries. It was checked in [77] that all the fields of the Misner-Sharp equations are incoming except for the density field. Therefore, the boundary conditions that must be applied between each subdomain are.
Where rl, f and rl+1,i means the last grid point in the subdomain Ωl and the first grid point in the subdomain respectively. A diagram of the imposition of the boundary conditions between the subdomains can.
Figure 4. Sketch of the application of the boundary conditions between the different subdomain grids.  Through an analysis of characteristics, can be identified the flow of the field variables u and v, and apply the prescription of Eq.70.  The use of multigrids in spectral methods has a similar idea to the use of an adaptative mesh refinement (AMR) in finite differences, to increase the resolution of the grid in some regions. Actually, the use of AMR was essential in [91] to verify the scaling law behaviour for the PBH mass in the critical regime.  A known weak point of spectral methods is when they have to handle discontinuous solutions, particularly with the presence of shocks, since the derivative at each point is computed globally, and therefore, the discontinuity is quickly propagated to the other parts of the grids. In this situation, it is better to use a finite differences approach, although usually is still needed a modification on the numerical implementation to be able to capture shocks, like the introduction of artificial viscosity.  However, as has been mentioned in section 1, in our case, shocks are not formed in the simulations since we should consider initial conditions at super-horizon scales [91].
Numerical procedure
In all the simulation we fix the value of w, t0 = 1 and a0 = 1. From that we automatically get H0 = α, RH(t0) = 1/H0 and recall that α = 2/3(1 + w). For the initial lengthscale of the perpetuation is usually considered rm = 10RH(t0) (Λ = 10), which is sufficient to ensure the long wavelength approximation as was indicated in [72].  First, we are going to focus on describing the procedure to obtain the threshold δc, and we leave the method to get the final mass MPBH,f for the following subsection. To obtain the threshold is used a bisection method, which compares different regimes of δm until finding the range in which appears the formation of the apparent horizon. The threshold δc corresponds to the midpoint of this range.  An example of a successful procedure is the following: • Create the different grid points x˜k,l for the different subdomains Ωl with a given number of points Ncheb,l, and compute the different Chebyshev differentiation matrices Dl . Introduce also the initial time step dt0, which usually dt0 ≤ 10−3 is enough to ensure stability.  • Specify a lower and an upper limit in δm of the bisection. Can be chosen the maximum value δmax = f(w) for the upper limit, and for the lower bound δmin ≈ w (which correspond to the threshold estimation using a Jeans length criteria). To reduce the computational time can be chosen a closer domain to the δc if such domain is known.  • A value δm is taken once the bisection starts. From that, can be build the curvature profiles K(r) or ζ(r˜) and find the location of the compaction function peak rm, r˜m using Eqs.49, 51 respectively.  Subsequently, compute the perturbations of the hydrodynamical variables following Eqs.39,40.  • Integrate the Eqs.28, 31 at each time-step dt using the four-order Runge-Kutta method, imposing at each internal time-step the boundary conditions at r = 0 and r = rf . Including the internal boundary conditions between the different Chebyshev grids Eq.70.  • To distinguish numerically the formation of an apparent horizon or not, we use the peak value of the compaction function in time. When the peak approaches Cmax ≈ 1, it implies the formation of the apparent horizon 3 . In this case, the value of δm chosen would imply the formation of a black hole, i.e.  δm,yes, and therefore a lower value δm closer to δc must be found modifying the bound of the bisection in such way that δc ∈ [δc,min, δm,yes]. In the opposite case, when Cmax decreases continuously for some time, this will imply the dispersion of the perturbation and the bisection bound should be modified as δc ∈ [δm,no, δc,max].  • The previous steps are iterated until the difference between δm,yes and δm,no is lower than the desired resolution, i.e., δm,yes − δm,no . δ(δc). From that, the threshold value is defined as δc = (δm,yes + δm,no)/2 ± δ(δc). When δm approaches the critical value, in some cases the grid resolution initially set up is not enough to follow the evolution, if so then δm is shifted according to δ(δc) to avoid being close to δc. Another alternative would be the dynamical inclusion of more subgrids in the desired region where gradients start to be large.
During the time evolution is used a conformal time step dt = dt0(t/t0) α , which improves substantially the performance of the simulation. The 2-norm of the Hamiltonian constraint equation Eq.25 is computed 3 Technically, the condition of formation of the apparent horizon is given when 2M(r, t)/R(r, t) = 1. But for computationally efficiency, is easier to check whatever C ≈ 1, since C = 2M(r, t)/R(r, t) − 2Mb(r, t)/R(r, t), which avoids to find the cosmological horizon. At each time step. It is expected that the constraint should remain constant from t = t0 if Einstein equations are correctly solved. In particular, where the label l refers to the sum of the different Chebyshev grids and k to the different points of the grid.
Numerical estimation of the final PBH mass
To obtain the final mass of the PBH MPBH,f we use an excision technique, and we describe it with detail in this section. Saying that, other alternatives in the literature have used null coordinates with the Hernandez-Misner equations [56,64,66] to get the final mass. We refer the reader to these references, but the primary approach followed can be summarized as follows: i) The simulation is set up with some initial data using the Misner-Sharp equations. ii) Starting the evolution, an outgoing null radial ray is sent from the centre to the outer point of the grid, and the values of the field variables are stored once the ray crosses each grid point. iii) The Misner-Hernandez equations are evolved using the initial conditions obtained in the previous step, which are basically the values stored.  Let’s focus now on excision. The main idea of an excision technique is based on the fact that nothing inside the event horizon can affect the physics outside. Therefore, the aim is to dynamically remove the segment of the computational domain inside the apparent horizon, to avoid large gradients appearing and breaking down the simulation.  There are different procedures to implement excision, but the one we have used here is the following: We define two parameters, ∆r and dr (always we consider ∆r > dr), where ∆r is the distance separation between the apparent horizon and the excision surface that we establish after each redefinition of the excision surface, and dr is the maximum allowed displacement of the apparent horizon before we create a new excision boundary. At each time step, we locate the position of the apparent horizon, taking into account that 2M(r∗, t)/R(r∗, t) = 1, where r∗(t) is the location of the apparent horizon in time. Since we handle a discretized grid, we use a cubic spline interpolation to find the correct value of r∗(t) (the difference of taking a quadratic spline interpolation is O(0.01%) for the PBH mass values).  In particular, the method used is the following: For a supercritical perturbation, when the peak of the compaction function Cmax ≈ 1.2 (the final result is not affected by the exact value that we take, as long as we consider Cmax ≈ O(1)), part of the computation domain is removed, creating an excision surface close to the location of the apparent horizon, whose separation from the excision boundary is basically given by ∆r. Once done this, we create a dense but small Chebyshev grid starting from the excised boundary. Another single Chebyshev grid can cover the other domain since large gradients are only developed near the excision surface.  We evolve in time the Chebyshev grids in the usual form independently, and we track the apparent horizon motion at each dt. Once the apparent horizon has been moved a distance greater than dr, we create a new excision surface separated a distance ∆r from the apparent horizon. During the evolution, we need to continuously reduce the values ∆r,dr, since the velocity of the apparent horizon decreases in time. This is especially important for very small δm − δc. We decide to reduce ∆r,dr when the Hamiltonian constraint starts to be continually violated. In particular, it was found that considering ∆r ≈ 2dr ≈ O(10−2) works nicely for our purposes.
There is no physical boundary condition to apply at the excision surface. Still, it was found that to freeze the gradient of ρ 0 at the excision surface, after each redefinition of the excision boundary, allows to increase the stability of the method without changing the numerical results.  6. Numerical results In this section, we are going to review some numerical results using the numerical procedure pointed out in the previous section. First of all, we are going to introduce a set of curvature profiles that allows us to span all different possible thresholds for PBH formation. Later on, we will see the dynamical evolution of the collapse for three different cases in terms of the initial amplitude δm and with a specific profile chosen. Finally, we will show the results regarding the final PBH mass in terms of the different profiles, as well as the effect of the accretion from the FLRW background.  The numerical results have been obtained using the procedure of section 5 with a computer i − 7, 16 GB of RAM and without parallelization procedures. As an example of the efficiency, in the case of w = 1/3 and with a Gaussian profile, to obtain the threshold δc with a resolution δm − δc ≈ 10−3 the running time was ∼ 3 − 5 minutes using the bisection method 5.2. To estimate the final mass MPBH,f was needed to run the excision method 5.3 for ∼ 3 hours for the largest PBHs. These values can differ when changing the profiles or equation of state w. The typical size of the grid chosen has been two or three grids with ∼ 100 points in each grid. However, it could be needed more points for sharp initial profiles. With these configurations, the maximum resolution obtained for the threshold in the case of a Gaussian profile has been δm − δc ≈ 10−5 (in the case of w = 1/3). With sharper profiles or larger w this resolution becomes slightly reduced.  6.1. Curvature fluctuations The seed of the generation of the curvature fluctuation is the power spectrum, namely P(k) where k is the wavelength. We briefly review the procedure assuming Gaussian statistics of [114] applied to our purposes. We consider that the amplitudes of the curvature perturbations are statistically Gaussian distributed accordingly to the specific inflationary model considered. Therefore, since PBHs are rarely formed, the over-densities leading to PBH formation are, with a very good approximation, spherically symmetric [114].
From the power spectrum Pζ (k) we can relate it to the curvature fluctuation is the the Fourier mode k of the field.  Notice that at linear theory and at super-horizon scales, the density contrast is related to as, and therefore.
From that, we can build the normalized two-point correlation function by, where the variance of the field ζ is given by.
Therefore, the curvature fluctuation ζ(r) assuming peak theory can be build as, where µ is the peak value of ζ.
In conclusion, using Eq.79 we can relate the power spectrum to our curvature fluctuation ζ(r˜), and from that set up the initial conditions following Eqs.40,41, or alternative also build K(r) using the transformations of Eqs.38.  Although it goes beyond the scope of the review, we should mention that one could also consider the effect of the inclusion of non-gaussianities in Eq.79. There are vast and extensive works that consider its impact on the thresholds, and PBH abundances [100,105,106,178–191], including some of them that have used numerical simulations following the basics shown in this review [192,193].  Saying that, it is much more practical to span already a set of curvature profiles instead of considering different power spectrums when we are interested in studying the physical process of PBH formation.  The reason is that setting up directly the curvature fluctuation would allow to modulate different shapes and therefore to get all possible thresholds and estimate their effects on the PBH mass. In any case, some typical power spectrum templates can be found in [107,178].  In the literature has been commonly used exponential families of profiles to modulate K(r) [70,72,74, 75]. Another possibility is a polynomial family [77]. Both can be written in a convenient way as.
The profiles of Eq.80 and Eq.81 corresponds to a polynomial and exponential (for λ = 0)-non centrally peaked (for λ 6= 0) profiles respectively. Notice that the profiles depends on the ratio r/rm. The profiles are written in a convenient way with the amplitude δm, in such away that when computing C(r) using Eq.48, automatically gives C(rm) = δm when evaluating r = rm.  On the other hand, the parameter q is a dimensionless parameter which relates how is the shape around the peak of the compaction function, which is defined as.
In terms of the r˜ coordinate, can be used the transformation in Eq.38 as was done in [194] to obtain.
Interestingly, in [76] was found numerically that profiles with the same q have the same threshold δc upon a deviation of O(3 − 4%) (and O(1 − 2%) in the particular case of a radiative dominated Universe), but we will discuss this in more detail in section 7, since this result will be used to obtain analytical estimations on δc.The benefit of Eq.80 in comparison with Eq.81 is that at r → 0 fulfills regularity conditions, something that Eq.81 not for some small values of q. Actually, the profile Eq.80 can be considered as a basis profile, since allows to span all possible thresholds values, as we will see in more detail in 6.3. The profiles of C(r) for the polynomial profile can be found in Fig.5. When q  1 the peak of the compaction function is sharp, while when q  1 the peaks is broad.  Figure 5. Left panel: Profiles of C(r) of Eq.80 for several values of q. The values δm has been normalized to δm = 1. Right panel: Density contrast δρ/ρb for the same profiles as the top panel. The profiles has been normalized to the peak δρ(0)/ρb . The negative peak value for q = 30 around r = rm goes up to ∼ −4.  A profile with two modulating peaks in C was also considered in [80]. It is similar to the one considered in [71], where double PBH formation was studied.  The value of the second peak of C can be modulated as.
Different profiles of the three families are plotted in Fig.6. In particular we have plotted the profiles Eqs.80,81,84 and from them we have also plotted the corresponding compaction function from Eq.48, as well as the density contrast Eq.40. The conversion from K(r) to ζ(r˜) can be made using Eq.38.  Figure 6. Plot for the profiles with Eq.80, Eq.81 and Eq.84 for C(r) (top-left), δρ(r)/ρb (top-right), ζ(r) (bottom-left) and K (bottom-right) as function of r/rm for δm ∼ δc. The dotted black line corresponds to q = 0 and the dashed black line to q → ∞. The values taken for Ctt(r) are δ1 = δc(q1), q2 = 3, rm1 = rm2 = 1, rj = 2rm1 , Ctt(peak,2) = 0.3, with the corresponding δ2 obtained from Eq.86 using the previous parameters, q1 = 5 (violet) and q1 = 1 (orange).  6.2. Non-linear behavior of the gravitational collapse In this subsection, we show the behaviour of the gravitational collapse of the curvature fluctuations for three different regimes. As an example is considered a Gaussian profile given by Eq.81 with q = 1 (λ = 0) and for different values of δm and w = 1/3. However, the same qualitative behaviour can be found for other profiles and other w 6= 0. In particular, can be establish three different regimes: subcritical (δm < δc), supercritical (δm > δc) with | δm − δc | O(10−3) in both previous cases, and critical | δm − δc |6 O(10−3).
In Figs. 7 (supercritical), 8 (subcritical) and 9 (critical) we see the evolution of the variables ρ, Γ, U and C.  In the case of a super-critical evolution, which is the case of Fig.7, we can observe that the compaction function grows during the evolution. The gravitational collapse increases the energy density on the central regions, and therefore the mass excess grows. It is also obvious the formation of the two horizons as discussed in section 4.3. The outer horizon moves outwards, and the inner moves inwards, faster than the outwards. The simulation breaks down when the inner horizon approaches r = 0. It is when the excision technique has to be applied to remove the singularity.  In Fig. 8 (the sub-critical case) the compaction function decreases continuously as the perturbation is diluted away due to the superiority of pressure gradients against gravity. In general, for late times, the peak Cmax is pushed outwards due to the pressure gradients. This behaviour can also be seen with the peak value of ρ/ρb . In the supercritical case, the peak value is continuously increasing. In contrast, in the subcritical case, the peak value starts to decrease at some moment (which means the perturbation start to disperse). In addition, from the Figs. 7, 8 and 9 can be observed that Γ is not constant during the evolution.  As expected, the gradient expansion approximation fails for sufficiently late times t  t0.  In Fig. 7 (super-critical case) we observe that U/Γ decreases quickly in time, and a negative velocity mainly dominates the profile before rm for late times, which indicates the collapse of the fluid. Instead, in Fig. 8 (sub-critical case) only a small negative value U/Γ is reached for early times, and beyond that, the values are positive, which indicates that the perturbation is dispersing, avoiding the gravitational collapse.  The most relevant behaviour is found in the critical regime, in Fig. 9. Here the fluid is divided into two parts, one going outwards (positive U) and one inwards (negative U), which generates an under-dense region. This under-dense region re-attract the fluid with a net effect of compression and rarefaction process, which increases its velocity in time. In this situation, the gradients become very large and eventually break down the simulation if a sufficient resolution has been not set up for the simulation.  It is interesting to mention that in the presence of secondary peaks in C(r) (not only one isolated), with an amplitude roughly equal or less than the first one, it was verified numerically in [193] that those secondary peaks decrease and disperses on the FLRW background, even in the case of supercritical perturbations. A different situation could happen when a secondary peak is sufficiently high. In such case, the secondary peak could also collapse even if the first peak is not greater than the threshold value to collapse itself.
Figure 7. Dynamics of the different magnitudes in the case of a supercritical fluctuation (Gaussian profile) at given times t. In particular δm = 0.51 and δc = 0.49774 ± 2 · 10−5 .  Figure 8. Dynamics of the different magnitudes in the case of a subcritical fluctuation with δm = 0.49 (Gaussian profile) at given times t. In particular δm = 0.49 and δc = 0.49774 ± 2 · 10−5 .
Figure 9. Dynamics of the different magnitudes in the case of a perturbation close to the critical threshold δm ≈ δc (Gaussian profile) at given times t. In particular δm = 0.49775 and δc = 0.49774 ± 2 · 10−5 .  In Fig. 10 is shown the correctness of the numerical evolution using the Hamiltonian constraint of Eq.72 at each step. It corresponds to different evolutions of the gravitational collapse, both subcritical and supercritical. In the figure can be seen that the constraint starts to be violated for late times for (δm − δc) ≈ O(10−5), which gives a bound on the maximal resolution for δc (in this particular example) Figure 10. Right panel: Hamiltonian constraint for the numerical iterations of the bisection procedure in the case of a profile given by a Gaussian fluctuation for the supercritical case with Eq.81 and q = 1, λ = 0 .  Left Panel: The same as the right panel but for subcritical fluctuations. The initial Hamiltonian constraint is subtracted for each evolution of δm in both cases.  29 of 58 The convergence with the use of spectral methods can be found in Fig.11. It is clear that the convergence is exponential, which is a high improvement in comparison with the methods of finite differences. In particular, the use of a multidomain grid improves the performance and accuracy of the simulations substantially, as is shown in the right panel of Fig.11, where the spectral accuracy is obtained with less number of points (in comparison with the left panel). Making the first grid Ω1 from r = 0 up to r = 2rm, allows capturing the region where large gradients are developed. Then for the second grid Ω2 from r = 2rm up to r = rf and only needed few points.  Figure 11. Spectral convergence for different profiles. Red points corresponds to the profile of Eq.81 with q = 1, blue points to q = 5 and green points to q = 10 (λ = 0 in all cases). The black solid line is the exponential fit ∼ e −αNcheb . Left panel: Case with a single grid Ncheb and α ≈ 0.23, 0.032, 0.022 respectively for the previous cases. Right panel: Case with two grids N1 and N2 = 50, with the second grid starting at r = 2rm, and α ≈ 0.59, 0.12, 0.06, with the same profiles of the left panel. The simulation corresponds to δm = 0.5 and t = tH for w = 1/3.  An interesting behavior is found for tAH when w is changed, as noticed in [77]. Although pressure gradients work against the gravitational collapse, since it is also a form of gravitational energy, it will mostly favour it when the collapse is active. consequently it implies a shorter time of formation for larger w, as can be observed in Fig.12.  Figure 12. Time that takes the fluctuation to form the apparent horizon tAH in terms of w. The fluctuation chosen corresponds to Eq.80 with q = 1 and δm = δc + 10−2.
As we have mentioned, the threshold for PBH formation depends on the shape of the curvature fluctuation. Following the numerical procedure in section 5.2 can be obtained all the possible thresholds for PBH formation using the basis polynomial profile of Eq.80. The results are shown in Fig.13 for different profiles. In the particular case of a radiation fluid, has been found in [72,76] that the range of all possible thresholds is δc ∈ [0.4, 2/3]. The minimum threshold δc,min = 0.4 corresponds to the limit case of q → 0 (broad profile in C, which would be a homogeneous sphere). Instead the maximum threshold δc,max = 2/3 corresponds to q → ∞ (peaked profile in C). Increasing q, larger are the pressure gradients, and therefore, the threshold value is higher.  Remarkably, the relative deviation between the thresholds for the different profiles in Fig.13 with the same q is within 2%. It was found for the first time in [76] and was shown that different profiles with the same q (shape around the peak of the compaction function) have the same thresholds within a small deviation.  Figure 13. Left panel: Threshold values δc in terms of q for the case of w = 1/3. Green points correspond to Eq.80, red points to Eq.81 with λ = 0 and blue to Eq.81 with λ = 1. Right panel: Threshold values δc in terms of q for different values of w corresponding to the polynomial profile of Eq.80.  In [77] were performed simulations of PBH formation in the case of a perfect fluid with w ∈ (0, 1]. The functional behaviour of δc in terms of q for different w’s is roughly similar as is shown in the left panel of Fig.13 (the case with fixed w = 1/3), but quantitatively the values are different. It is clear that increasing w, the gradients will be larger and therefore, the threshold increases since pressure gradient will be stronger.  The limits q → 0 and q → ∞ limits for the general case in terms of w are both amenable to further analysis.  • The case q → 0 corresponds to a C that becomes approximately constant over a wide range of scales.  Simulations, in this case, becomes difficult due to the presence of conical singularities [77]. To solve this issue, in [77] was used a modified profile of Eq.80 to subtract the mass excess beyond r  rm and fulfil that at the boundaries the FLRW background is recovered. In Fig.14 is shown the numerical values of δc(q → 0) in terms of w, which shows a strong dependence in w. As is expected, for w → 0 the threshold δc → 0.  • The case of large q → ∞ corresponds to the case of a sharply peaked for the compaction function.  For this kind of profiles, the pressure gradients acting against the gravitational collapse are maximal, and hence the compaction function should be maximal too. Analytically it is shown from Eq.48 that C(rm) < f(w) (at super-horizon scales). As was proved in [72] numerically, δc,max → f(w) in the case of radiation w = 1/3. The intuition is that the saturation should persist to larger values of w because larger values of w also imply larger pressures that fight against the collapse. Therefore, for w ≥ 1/3, the compaction function of a peaked profile must also saturate the bound f(w). It was verified numerically in [73]. This behaviour is not anymore true for w < 1/3. Something obvious in the case of dust w = 0, since f(0) = 0.6, but δc(w = 0) = 0 always for any profile. This is shown in the left panel of Fig.14. It should be taken into account that beyond q > 40, simulations do not obtain the threshold with enough resolution. This is the reason why the numerical value of the threshold for w = 1/3 does not exactly coincide with f(1/3) . One expects that in the asymptotic limit, q → ∞ should match with f(1/3) as was pointed out in [72] with the same argument.  Figure 14. Left panel:Threshold δc in terms of w for q → 0. Right panel: Threshold δc in terms of w for q → ∞, in particular has been able to perform simulation up to q = 40. The red line corresponds to the analytical case f(w), where the black dots correspond to the numerical simulations in the region where δc(q → ∞) 6= f(w) as shown in [77]. The blue dashed line corresponds to f(w) on that region.  It is interesting also to notice the difference between consider K(r) and ζ(r˜). As we have seen in section 4, there is a non-linear relation between ζ and C, which leads to some differences between the thresholds obtained for both profiles. Consider for instance a Gaussian profile in both cases.
Due to the non-linear relation between C and ζ at super-horizon scales, the δm,ζ (for this example let’s call δm,K and δm,ζ for both profiles) depends non-linearly on µ as.
Due to this, the qζ value in the case of the fluctuation ζ is dependent also on its amplitude µ and w, when for the K(r) in this example is just q = 1. A plot on the thresholds δc for both profiles can be found in
Fig.15 for different w’s. Although both profiles are Gaussian, they have a different δc due to the non-linear relation with ζ(r˜). The threshold for ζ(r˜) is higher than K(r) since the shape around the compaction function is sharper, which means a larger q, as can be observed in the bottom panel of the subplot in Fig.15.  It also has an implication for the PBH mass, as we will see in the next subsection.
Figure 15. Thresholds δc in terms of w for two profiles. Red dots corresponds to the Gaussian with K(r), and blue dots with ζ(r˜) instead. The top-subplot is the critical amplitude µc of the profile in ζ(r˜). The bottom-subplot is the value q of the critical profile ζ(r˜) for each w.  A Gaussian family of profiles with ζ(r˜) = µe −(r/rm) 2p was considered in [104] for estimation of PBH abundances taking into account the non-linearity of ζ(r˜) for w = 1/3. There was found a range of thresholds 0.442 < δc < 0.656 for 0.34 . p . 2.
PBH masses
Once the apparent horizon is formed, an excision technique following section 5.3 can be applied to remove the singularity. An example of the evolution of the PBH mass MPBH(t) for the profile of Eq.81 with q = 1, λ = 0 and different amplitudes δm can be found in Fig. 16. The initial time of the curves corresponds to the initial mass of the PBH MPBH,i at the time of formation of the apparent horizon tAH.  As can be seen in Fig.16, when the amplitudes δm increase the PBH mass will be higher.  Figure 16. Evolution of the mass of the PBH for w = 1/3 after the formation of the apparent horizon for the profile of Eq.81 with q = 1 and λ = 0. The colour lines correspond to different values of initial amplitudes δm. The dashed line corresponds to the analytical fit using Eq.54. Threshold value δc = 0.49774 ± 2 · 10−5.
Figure 17. Top panel: Time evolution of the Hamiltonian constraint for different amplitude values δm during the excision procedure. Bottom panel: Numerical evolution of Ψ in time. The crossing point is around t/tm ≈ 37.5. The profile used is the same as in Fig.16.  The amount of time needed until reach the stationary regime where the PBH mass remains constant could be substantial and therefore computationally expensive. As we have mentioned, to avoid that can be used Eq.54 to estimate the final mass of the PBH after the accretion process accurately.  In order to find the domain in time where the approximation of Eq.54 is valid, in [73] was computed the ratio of the increment in time of the black hole mass with respect to the Hubble scale Ψ = M˙ /HM, which is predicted to be Ψ < 1 when the evolution of the PBH mass satisfies this regime. During the application of the excision technique, the Hamiltonian constraint is monotorized using Eq.72. In the simulations in [73,80] the constraint is fulfill until very late times, as is shown in Fig. 17. Nevertheless, it seems that the evolution of the mass was not affected substantially by the violation of the constraint.  Interestingly, in the bottom panel of Fig.17 was observed a crossing for different evolutions of Ψ at a given time t ∗ . In Fig.18 is shown the evolution of MPBH(t) in time for different values of q and two different profiles. It is clear that as large is q less is the final PBH mass MPBH,f, since the pressure gradients are stronger and prevent accretion from the FLRW background. Notice the differences of MPBH(t) between the two profiles considered in the figure. Even with the same q, the values for the mass are different since the full shape of the profile will contribute to the final mass.  34 of 58 Figure 18. Top: Evolution of MPBH(t) for the profiles q = 1.5, q = 3 and q = 10. Dashed line corresponds to Eq.81 with λ = 0 and solid line to Eq.80. Bottom: Time evolution of the Hamiltonian constraint. In all cases δm − δc = 5 · 10−3 .  To get the parameters ta, Ma and F can be performed a non-linear fit using the function of Eq.54 with the data MPBH(t) coming from the simulations. The range of values to make the fit are those which fulfill Ψ . 0.1. The values of F that has been obtained in the literature making the non-linear fit have been in the range F ∈ [3.2, 3.8] (for the case of w = 1/3) in terms of the different profiles and amplitudes δm. Some indicative results regarding the accuracy of the fits done are: σmax ≈ 10−2 (variance) sd, where sd is the standard deviation of the parameters. It is consistent with what already was stated in [139–141] that the numerical coefficient F must be O(1). In particular, in the case of the collapse of domain walls was found F ≈ 3.8 for large black holes[143].  Interestingly, in [80] was quantified the effect of the accretion (from the FLRW background) to the grow of the PBH until reach the stationary regime, namely MPBH, f /MPBH,i , for the case w = 1/3. As was pointed out, the accretion should not be important for small PBHs, i.e, with δm near the δc. But the situation differs for relatively large PBHs. It can be seen precisely seen in Fig.19. The accretion can be significantly important for large δm.  Sharp profiles, corresponding to large q, have larger pressure gradients and therefore the ratio MPBH,f/MPBH,i is smaller, even for large δm, since the gradients prevent the accretion. For low MPBH,f the ratio MPBH,f/MPBH,i should be small, as expected [7,79]. When MPBH,f ' MH, i.e. for PBHs with higher probability to form, was obtained MPBH,f ' 3MH. In comparison, a similar result was also found in the case of the collapse of a massless scalar field [138] and in [143,195] from BHs formed from the collapse of domain walls or vacuum bubbles, with a factor MPBH,f/MBH,i ≤ 2.
Figure 19. Accretion effect on the final PBH mass measured as the ratio MPBH,f/MPBH,i in terms of δm − δc(q) for different profiles with w = 1/3. Stars to Eq.81 with λ = 0, circles correspond to Eq.80 and triangles to Eq.84. The ratio MPBH,f/MPBH,i for PBHs with MPBH,f ' MH is shown in the subplot.  An example of values of PBH mass for other values of w can be found in Fig.20, where is shown the ratio MPBH, f /MH using a Gaussian profile Eq.81 with q = 1 (λ = 0) for those PBHs MPBH, f /MH ≈ 1. The PBH mass MPBH, f is very sensitive to w as expected. When w increases, gradients are larger, preventing the accretion and the increase of the PBH mass. The ratio MPBH, f /MH is larger for smaller w at the same δm − δc, since the accretion is substantially higher when pressure gradients are decreased, as can be seen in the bottom panel of Fig.20. In this case, the values of F differ substantially from w = 1/3. In particular, for the set of values w ∈ [0.2, 1/3, 0.5, 0.7] it corresponds to F ≈ [7.2, 3.8, 2.0, 1.37] respectively, which already clearly indicates the substantial accretion for small w. Moreover, the time needed to reach the asymptotic regime of Eq.54 is much higher as smaller is w. For example, in the case of δm − δc = 10−2 for w = 0.2 and w = 0.5, was needed a time of order t/t0 v 104 and t/t0 v 103 respectively to reach the asymptotic regime.
Figure 20. Top panel: Values of the final PBH mass in terms of MH for some values of w in terms of δm − δc.  Bottom panel: Accretion effect on the final PBH mass for some values of w in terms of δm − δc. In both cases has been used the profile of Eq.81 with q = 1 and λ = 0.  On the other hand, in [79] were made some analytical approximations regarding the maximum size of the PBHs fromed from hydrodynamical perturbations at the time of formation of the apparent horizon, in particular was found that.  This analytical result (derived for 0 < w ≤ 1) was verified numerically in the case of a radiation fluid in [80], where was also performed an extensive study on the values MPBH,i, RPBH,i and tAH for different profiles and amplitudes δm.  To compute the value of the constant K in front the scaling law Eq.56 is needed to estimate the final mass of the black hole MPBH, f using perturbations with an amplitude near the critical regime, i.e, δ → δc. A range of 10−3 . δ − δc . 10−2 is sufficient to estimate it, since the gravitational collapse of the fluctuations happens in the critical regime. Beyond that, the scaling law becomes deviated. In particular, for a radiation fluid can be taken directly the value γ = 0.357 [59,196] to obtain K from a given δm − δc (for other values of w check Fig.3 and the caption).  In Fig.21 are shown the values of K for the profiles of Eq.80, Eq.81 and Eq.84 as an example on how changes K changes in terms of the profile. The value of the PBH mass MPBH,f (and therefore also K) is affected by the shape of the profile beyond the peak of C since the accretion process depends on the full shape of the fluctuation, in comparison with the threshold δc that as was pointed out in section 6.2 mainly depends on the shape around the compaction function peak.
Figure 21. Dependence of K as a function q for the profiles in Eq.80 (red), Eq.81 with λ = 0 (black), Eq.81 with λ = 1 (blue) and Eq.84 (green). The parameters used for the profile Ctt(r) are q2 = 3, rj = 2rm1 , Ctt(peak,2) = 0.3, and δ2 is obtained from Eq.86 using the previous values with and q1 = q.  In the case of the profile Eq.80, K tends to ≈ 3.5 for large values of q. The value of K tend to increase as q decreases, as shown Fig.21. Numerically, in [80] was not able to obtain the final mass MPBH,f for profiles q . 0.5, due to conic singularities, as was already found in [77].  On the other hand, in Fig.22 can be seen an explicit example of MPBH, f for a Gaussian profile (in both K(r) and ζ(r)) in terms of MH for large values of δm beyond the critical regime δm & 10−2 with w = 1/3.  As can be observed in the subplot of Fig. 22, the scaling law deviates for the highest allowed values of δm to O(15% − 20%) for both cases. For this particular cases, the maximum allowed mass of the PBH formed is MPBH, f ≈ 3.7MH and MPBH, f ≈ 2.3MH respectively. It is expected in principle that this deviation from the scaling regime is not going to significantly modify the estimation of the PBH abundance, due to the unusualness of such perturbations since those PBHs with the higher probability to form are with MPBH, f ≈ MH. It is important to also notice that the masses generated with the profile ζ(r˜) are lower than those with K(r), since although they are both Gaussian, they have q > 1 and q = 1 respectively, and sharper profiles have less mass due to stronger pressure gradients, as we have seen in Fig.18.
Figure 22. Values of MPBHf /MH in terms of (δm − δc) for two Gaussian profiles in K(r) and ζ(r˜). Dark points corresponds to the numerical values for the profile in K(r). The solid red line corresponds to the scaling law behaviour with γ = 0.357, δc = 0.49774 for K = 6.03 (pointed out in [91]) and the blue solid line with the numerical value obtained in the review with K = 5.91. The absolute value of the relative deviation d respect the numerical values and the ones coming from the scaling law is shown in the subplot. The orange vertical line is the value δmax = 2/3. On the other hand, the green dots correspond to the case of the Gaussian profile in ζ. The solid green line is the scaling law with γ = 0.357, δc = 0.55257 and K = 3.98 (in [197] for this profile was given K ' 4.0). The vertical magenta line corresponds to the case δmax = 2/3 for this profile. In both cases w = 1/3.  7. Analytical estimation for the threshold of PBH formation In this section, we review in detail the current analytical estimations used in the literature for the threshold of PBH formation from curvature fluctuations with an equation of state w. The first analytical estimation came from [67], where using a Jeans length approximation was shown that, δCarr = w . (90) Although this approximation is simply, it fulfill some properties: i) at w = 0 (dust) any curvature fluctuation should collapse, i.e, δc(w = 0) = 0. ii) as large as w pressure gradients are larger, so the threshold should be higher. This approximation was obtained assuming the argument that the size of an overdensity (that leads to PBH formation), at the maximum expansion, should be smaller than the particle horizon and larger than the Jean radius (Jeans criteria).  See also section 2 for a simple derivation.  Later on, in [68] improved the previous estimation of [67] by using a sophisticated and interesting model (a three-zone model) of the collapse of a homogeneous overdense sphere surrounded by a thin underdense shell. We suggest the reader check [68] for more details on the model and assumptions done.  The threshold estimation that they got was.  It was also provided with an upper δ + HYK and lower bound δ − HYK on δc, to take into the different ways to apply the relativistic Jeans criteria for this model.
These previous estimations (in particular Eq.92) have been extensively used in the literature, but as was already noticed [67,68] these estimations are not profile dependent and therefore do not take into account the specific shape of the curvature fluctuation.  7.1. Shape-dependent analytical estimation of the threshold for radiation fluid In [76] was pointed out and proved that, to a very good approximation, the threshold for the w = 1/3 case only depends upon the curvature of the compaction function at its maximum, under the assumption of a central over-dense peak in the density distribution. It was used to build an analytical formula for the threshold with a dependence on the profile considered. The formula was accurate enough and only deviated 2% in comparison with numerical simulations.  The main two ingredients of the procedure used in [76] were: i) parametrize the shape around the compaction function peak with a dimensionless parameter q ii) use the average of the critical compaction function. As was shown in [76] and as we have already mentioned, to a very good approximation, the threshold only depends on, which is a dimensionless measure of the curvature of C(r) at its maximum. This means that different profiles but with the same q value will have the same threshold upon a small deviation of < 2%.  The next point is to define a “basis” (or fiducial set of curvature profiles) such that, by varying q, this set covers the whole range of interesting thresholds and shapes with q ∈ (0, ∞) while also being regular at r = 0 and having. In [76], this basis was given in terms of the exponential functions
Eq.81 (with λ = 0). Although it strictly does not satisfy regular conditions for q → 0 at r = 0, this limit was tested numerically with the polynomial basis of Eq.80.  Taking into account this, the averaged critical compaction function integrated from r = 0 up to the peak r = rm is defined as.
Introducing the profile considered into Eq.96, we can solve analytically the integral to get, where Γ(x) is the gamma function, Γ(x, y) is the incomplete gamma function and we have used Cc(rm) ≡ δc. In the case of a radiation fluid, when q → ∞, it was confirmed numerically that δc(q → ∞) = f(w = 1/3) = 2/3 [72]. Taking into account this analytical limit into Eq.97, we get.  The assumption done in [76] was to consider that C¯ c is a profile-independent quantity, and therefore c = 2/5 for any value of q. The assumption was tested extensively numerically for different profiles, and was found to be consistent with numerical simulations up to a small deviation of O(2%) in δc. Inverting Eq.97 in δc with C¯ c = 2/5, we finally get the analytical threshold formula δc in terms of the specific profile q, in the case of a radiation fluid.
This remarkable result in [76] was the first analytical estimation shown in the literature for the threshold of PBH formation, taking into account the shape of the fluctuation, with enough accuracy to be used for estimations of PBH abundances [92]. A plot of Eq.99 in terms of q can be found in Fig.23.  Figure 23. Plot δc(q) of Eq.99.  7.2. Generalization of the analytical threshold beyond radiation fluid Later on, the procedure used in [76] was generalized considering PBH formation within a perfect fluid with w ∈ (0, 1] on a FLRW background, and was found that the threshold averaged compaction function within a concentric sphere of radius rm(1 − α(w)) ≤ r ≤ rm, is, to a very good approximation, again universal in the case 1/3 ≤ w < 1. This was used to provide a new and improved analytical formula for the threshold that only depends upon the normalized second derivative of the compaction function at its maximum and the equation of state w. This formula was proved to be accurate at order 6% compared to numerical simulations and reproducing the same result for the case of radiation w = 1/3.  4 The gamma function Γ(x) is defined as. The incomplete gamma function is defined as Γ(x, y) = R ∞
In [76], the basis profiles used were given in terms of the exponential functions; although that, since the boundary conditions at r = 0 are violated for q < 1/2, was considered the basis profile of Eq.80 instead.  This set of profiles satisfies the appropriate boundary and regularity conditions.  The critical compaction function, averaged within a spherical shell extending from radius [1− α(w)]rm to rm (the peak), is defined to be. Inserting Eq.80 in Eq.100 yields, where 2F1 is the hypergeometric function6.
The key point is that as was shown numerically in [77] the dependence of the averaged critical compaction function on the profile shape is weak enough to be ignored, and therefore universal.  Therefore, the analytic expression for the critical threshold value reads as.
The functions α(w) and C¯ c(w) were found using two different procedures: i) a numerical double fit minimization using the numerical results of the thresholds for different profiles ii) and making a single numerical fit minimization using already the analytical result that δc(q → ∞) for w ≥ 1/3. Both procedures gave equivalent results. Therefore, the assumption of C¯ c(w) being universal was found good enough and verified numerically for w & 1/3. This result verified the previous one obtained for a radiation fluid w = 1/3 in [76], where α = 1 and C¯ c = 4. In particular, using the procedure i) was found. The hypergeometric function is defined as, instead, using the ii).
A Comparison between analytical estimates
In [77] was compared the analytical estimation obtained Eq.106 with the previous ones in the literature, i.e, Eq.90,92. In Fig.24 is shown the comparison. The solid lines in Fig.24 show these approximations; the symbols with error bars show δc(w) from numerical simulations of the profiles of Eq.80 with q = 0.015, q = 0.1, q = 1 and q = 30. The dotted and dashed curves, which describe significantly better the result of the numerical simulations, show the result of inserting Eqs.107 and 108, or Eqs.109 and 110, in the Eq.106.  In both cases, Eq.106 (as well as the simulations) exceeds even the upper bound claimed by [68] at even lower w as q increases, which are Eqs.93,94.  Figure 24. Dependence of threshold δc on w when the initial profile is given by Eq.81 with q = 30, q = 1, q = 0.1, q = 0.015 and λ = 0 in all the cases (q = 0 would be a homogeneous sphere). The solid lines with dots and error bars show the results of the numerical simulations. The green and blue curves show the minimal and maximal bounds of δc from [68], in particular Eq.94 and Eq.93 respectively. The magenta line shows the approximation for δCarr of Eq.90. The black curve shows δHYK from Eq.92. The other curves show the approximation (Eq.106) in which δc depends both on w and q. Finally, the dotted curves uses Eqs.109 and 110 in Eq.106 whereas the dashed curves use Eqs.107 and 108 in Eq.106.  As can be observed, the discrepancy of the estimations Eq.90,92 for the case of small w is as large as 50% for the case q = 0.1. This is the limit that was considered successful and optimal for the approximations on which Eq.92 is based. This deviation is even bigger than the one found earlier because Eq.92 was compared with a Gaussian profile (Eq.81 with q = 1 and λ = 0). Actually, in the case w < 0.15 the solid black curve in Fig.24 does give a satisfactory description of the simulations with q = 1. However, the top-hat profile with q → 0, which is the one used in the analytic estimations of [68], is quite better approximated by q  1. For q = 0.1, the formula Eq.92 does not describe the simulations particularly well, and the discrepancy at w < 1/3 is even worse when q = 0.015 is taken. It was claimed in [77] that this disagreement seems to suggest that the supposed agreement shown in Fig.3 of [68] is a result of numerical coincidences, with no physics implications.
Finally, the polynomial basis profile of Eq.80 fulfills regularity conditions for q → as we have pointed out before, something not fulfilled with the exponential basis Eq.81 (with λ = 0). Precisely, this lead in previous literature [72] to infer that the minimum threshold for PBH formation (in the case of a radiation fluid) must coincide to the estimation of [68], i.e, δc,min(w = 1/3) = δHYK(w = 1/3) ≈ 0.41. In [72], was possible to compute δc with q = 0.1 as smaller value using Eq.81 (with λ = 0), since as was indicated there, the profiles were too sharp. This actually looks related to the fact that the exponential profile Eq.81 does not satisfy regularity conditions at r → 0 for q < 0.5. Instead, in the case of using the polynomial profile Eq.80 it allows to do simulations even to smaller values in q, up to q = 0.01, as were done in [76]. Therefore this leads to the conclusion in [76] that, for a radiation fluid, the correct range of values for the threshold is 0.4 ≤ δc ≤ 2/3, and therefore the minimum value was lower than δHYK. Indeed, the generalization of δc in w already indicates that the minimum threshold should not correspond necessarily to the one of δHYK.  8. Other scenarios of PBH formation In this review paper, we have mainly focused on the study of PBH formation from the spherical collapse of primordial density perturbations, which is currently the case most studied in the literature and with more results and applications [32]. Although that, many other mechanisms and scenarios could have led to black holes formed in the very early Universe [9]. In this last section, we try to briefly enumerate other scenarios beyond the ones considered in this review.  The case w = 0 is very special as the threshold of PBH formation, for an infinitely long matter domination era, is 0. Thus a study of abundances, where the Universe is matter-dominated for a finite time, differs a lot from the case of radiation. Some works have considered this scenario with scalar fields type [198–203], specially taking into account the oscillatory behavior of scalar field during the reheating. Recently in [204] were performed simulations in full GR using scalar fields to modulate the perturbation and the expanding dust background of the Universe, showing that the PBH mass grows beyond the self-similar limit MPBH ∝ H−1 , at least initially. The dust collapse has also been studied in a more oriented perfect fluid scenario [205]. The PBH formation has also been considered in the context of the LTB (Lemaitre-Tolman-Bondi) model [206,207]. In [208] was studied the effect of inhomogeneity on PBH formation in the matter-dominated era and its consequences on the PBH production. On the other hand, in[209,210] was studied the non-spherical effects and spins for PBH formation in the case of dust dominated Universe, showing it could have a significant effect.  A non-spherical effect, in principle, could dramatically change the threshold value and PBH mass [211]. Some analytical estimations taking into account an ellipsoidal collapse were done in the past, showing that the effect could be important [206,212]. However, in [213], for the first time in the literature, was performed the first numerical simulation in 3 + 1 spacetime (beyond spherical symmetry) for PBH formation from the collapse of curvature fluctuations, with a small (perturbative) non-sphericity initial condition (with a radiation fluid). The main conclusion was that the effect of ellipticity on the threshold for PBH formation is negligible in the standard scenario of PBH formation in the radiation-dominated Universe. This situation could dramatically change if it is considered an equation of state different from radiation as indicated in [213]. In particular, for a matter-dominated Universe, the effect of any sphericity could be important [205,209,210]. Another possibility is the inclusion of angular momentum to analyze the spin generation to PBHs; some analytical estimations have been done [214], but still are necessary numerical simulations to test those arguments. Recently has also been considered analytically PBH formation with an anisotropic perfect fluid [215].
The usual scenario of the collapse of cosmological density perturbations considers a constant equation of state w (mainly w = 1/3 in the literature). But the Universe has a thermal history where the equation of state is not necessarily constant, i.e, w(t). A particular (and very popular) example applied to the PBH scenario is the QCD epoch [216–219]. During the QCD phase transition, the equation of state w could have been softened. Looking at the result of the simulations in Fig.24 it is already clear that the threshold δc will be reduced, and therefore, makes the formation probability of PBHs exponentially more likely. Several works have addressed this scenario with progressive refinements [216,220–225], specially with the new calculations regarding lattice QCD [226,227]. However, numerical simulations are still needed to fully verify the effect on how much could change the threshold, PBH mass and mass function modifying the equation of state in time.  A bit more different mechanism of PBH formation comes from the collapse of Q-balls and Oscillons, which are features of supersymmetric extensions of the standard model [228]. Specific realizations of those ideas are done throughout theory motivated scalar field potentials, e.g, the axion-monodromy potential [229]. The mechanism for PBH formation of all these cases is naively similar: small number densities of defects lead to large fluctuations relative to the background density. These fluctuations become gravitationally bound and collapse to form black holes once the relic density has come to dominate. Finally, the relics decay due to some instabilities. Precisely, it has been argued that some solitonic type solutions like Q-balls and Oscillons could produce a significant fraction of dark matter in the form of PBHs [230–234], without relying on any spectrum of density perturbations.  On the other hand, scalar force instability can lead to a growth of structures and formation of halos of interacting particles (even on a radiation dominated Universe) [235–239]. Actually, in [238] was theorized that these structures could have collapsed and formed PBHs, but later on, it was realized that they should remain as virialized dark matter [239]. Precisely, in [240] it was shown that the radiative cooling due to the scalar radiation allows those halos to collapse into black holes. This was shown with a simple model with fermions interacting via Yukawa interaction. The general relativistic formulation of the interaction between a Fermi gas and a scalar field in cosmology has been carefully studied recently in detail in [241].  All these mechanisms could have small or large spins in terms of their formation evolution and the process of radiative cooling, as was pointed out in [211]. Another proposal is the one in [242], where the dilution of heavy quarks produced during inflation, which get confined by QCD flux tubes after horizon re-entry, could have led to PBH production.  Another mechanism is through the collapse of domain walls. Domain walls are topological defects that may form when a discrete symmetry is spontaneously broken in the very early Universe [243,244].  Several works have addressed this scenario and have shown the possibility to form PBHs and with astrophysical consequences [245–249]. Another possibility comes from the collapse of cosmic strings [250–252], which are 1 + 1 topological defects that are predicted beyond the Standard Model and could have lead to production of PBHs [253–259].  Similarly, it was also shown that vacuum bubbles could lead to a successful channel for PBH production or also been involved in related mechanisms [195,260–266]. They could have been formed during the inflationary epoch through a nucleation process. After inflation and depending on their size, these bubbles could collapse or even collide, forming black holes [179,193,246,267,268].  Other results has been also pointed out in the context of modified gravity, in particular in [269] was studied the PBH production in G-inflation and also in [270] was studied with the inclusion of a Gauss-Bonnet term. In [271] were considered the effects on the threshold in Eddington-inspired-Born-Infeld gravity.
Finally, a new mechanism appeared in [272], where PBHs could have been formed from the collapse of primordial CDM isocurvature fluctuations.  9. Conclusions In this review, we have focused on explaining in detail the process of PBH formation from the collapse of curvature fluctuations under spherical symmetry and its numerical implementation through a particular numerical technique. Specifically, we have seen that numerical simulations are essential to capture the correct and full-non linear behaviour of the collapse and formation of the PBHs. It leads to a better and accurate determination of the threshold of PBH formation and its masses compared to analytical estimations, something essential for the precise analysis of PBH abundances. In this review, we have seen a simple and efficient numerical procedure based on pseudospectral methods that allow us to fully solve the non-linear gravitational collapse of those perturbations and obtain the needed values of the threshold and PBH mass in the range of practical interest.  Two aspects in the literature have been remarkable important for the development of the field: i) the results found from numerical simulations about the critical scaling regime for the PBH mass ii) and the analytical estimations for the threshold of PBH formation. Both allow us to estimate the abundances of PBHs and constraint them. In particular, we have seen that the threshold and PBH mass are both dependent on the specific shape of the curvature fluctuation considered, and it’s crucial to take this into account for the precise analysis of PBH abundances instead of using a constant threshold or PBH mass value. Moreover, we have seen that the gravitational collapse is highly dependent on the equation of state of the fluid w. As large is w, smaller is the mass of the PBHs and the accretion from the FLRW background, but higher the threshold.  It is interesting to mention that the compaction function, firstly used in [70] years ago, has become nowadays essential. Not only for the definition of the threshold of PBH formation but also to obtain an analytical estimation of it, using its average.  There is still a lot of effort to be done in other directions and to consider different scenarios of PBH formation, as the ones already pointed out in section 8. Future theoretical developments and the implementation of numerical simulations to test and check those scenarios could lead to new possibilities for PBHs to account for dark matter and update the abundance estimations. In particular, it would be interesting to compare the results already pointed out in this review in other scenarios.  We hope that in the next few years, several scientific results in this and other directions will help to fully understand and constrain the PBH scenario and its consequences in our Universe, especially taking into account future gravitational waves observations.  Funding: AE is currently supported by "bourse de post-doctorat" from Université Libre de Bruxelles (ULB), and was supported by contract PID2019-106515GB-I00/AEI/10.13039/501100011033 (Spanish Ministry of Science and Innovation).
